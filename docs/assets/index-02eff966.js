import{s as d}from"./supabaseClient-4b466f7b.js";const h=document.getElementById("articles"),g=document.getElementById("add-article-btn"),u=document.getElementById("add-dialog"),s=document.getElementById("edit-dialog"),c=document.getElementById("delete-dialog");async function m(){const{data:{session:e}}=await d.auth.getSession(),t=document.getElementById("login-btn"),n=document.getElementById("logout-btn"),o=document.getElementById("add-article-btn"),r=document.querySelectorAll(".edit-btn"),l=document.querySelectorAll(".delete-btn");e?(t.classList.add("hidden"),n.classList.remove("hidden"),o.classList.remove("hidden"),r.forEach(a=>a.classList.remove("hidden")),l.forEach(a=>a.classList.remove("hidden"))):(t.classList.remove("hidden"),n.classList.add("hidden"),o.classList.add("hidden"),r.forEach(a=>a.classList.add("hidden")),l.forEach(a=>a.classList.add("hidden")))}async function i(){const{data:e,error:t}=await d.from("articles").select("*").order("created_at",{ascending:!1});if(t){console.error("Fetch error:",t);return}h.innerHTML="",e.forEach(n=>{const o=document.createElement("article");o.className="p-4 mb-4 bg-white rounded shadow",o.innerHTML=`
      <header class="mb-2">
        <h2 class="text-xl font-semibold">${n.title}</h2>
        <h3 class="text-sm text-gray-600">${n.subtitle||""}</h3>
      </header>
      <p class="text-xs text-gray-500 mb-2">
        Autor: ${n.author} • ${new Date(n.created_at).toLocaleString()}
      </p>
      <section class="prose prose-sm">${n.content}</section>
      <footer class="mt-4 flex space-x-2">
        <button data-id="${n.id}" class="edit-btn px-3 py-1 rounded transition-transform duration-200 ease-in-out hover:scale-105">Edytuj</button>
        <button data-id="${n.id}" class="delete-btn px-3 py-1 rounded transition-transform duration-200 ease-in-out hover:scale-105">Usuń</button>
      </footer>
    `,h.appendChild(o)}),v(),await m()}function v(){document.querySelectorAll(".edit-btn").forEach(e=>{e.addEventListener("click",()=>E(e.dataset.id))}),document.querySelectorAll(".delete-btn").forEach(e=>{e.addEventListener("click",()=>b(e.dataset.id))})}g.addEventListener("click",()=>u.showModal());u.querySelector("form").addEventListener("submit",async e=>{e.preventDefault();const t=e.target,{title:n,subtitle:o,author:r,content:l}=t.elements,{error:a}=await d.from("articles").insert([{title:n.value,subtitle:o.value,author:r.value,content:l.value}],{returning:"representation"});if(a){alert("Błąd dodawania: "+a.message);return}t.reset(),u.close(),i()});let f=null;function E(e){f=e;const t=document.querySelector(`[data-id="${e}"]`).closest("article");s.querySelector("[name=title]").value=t.querySelector("h2").textContent,s.querySelector("[name=subtitle]").value=t.querySelector("h3").textContent,s.querySelector("[name=author]").value=t.querySelector("p").textContent.split("•")[0].replace("Autor: ","").trim(),s.querySelector("[name=content]").value=t.querySelector("section").innerHTML,s.showModal()}s.querySelector("form").addEventListener("submit",async e=>{e.preventDefault();const t=e.target,{title:n,subtitle:o,author:r,content:l}=t.elements,{error:a}=await d.from("articles").update({title:n.value,subtitle:o.value,author:r.value,content:l.value}).eq("id",f);if(a){alert("Błąd edycji: "+a.message);return}s.close(),i()});let y=null;function b(e){y=e,c.showModal()}c.querySelector("#cancel-delete").addEventListener("click",()=>c.close());c.querySelector("form").addEventListener("submit",async e=>{e.preventDefault();const{error:t}=await d.from("articles").delete().eq("id",y);if(t){alert("Błąd usuwania: "+t.message);return}c.close(),i()});document.getElementById("logout-btn").addEventListener("click",async()=>{await d.auth.signOut(),await m(),i(),window.location.href="login.html"});window.addEventListener("DOMContentLoaded",async()=>{await m(),i()});
