import{r as l}from"./supabaseClient-f58d936c-bd9c57c3.js";const h=document.getElementById("articles"),v=document.getElementById("add-article-btn"),u=document.getElementById("add-dialog"),o=document.getElementById("edit-dialog"),c=document.getElementById("delete-dialog");async function m(){const{data:{session:e}}=await l.auth.getSession(),t=document.getElementById("login-btn"),a=document.getElementById("logout-btn"),r=document.getElementById("add-article-btn"),d=document.querySelectorAll(".edit-btn"),s=document.querySelectorAll(".delete-btn");e?(t.classList.add("hidden"),a.classList.remove("hidden"),r.classList.remove("hidden"),d.forEach(n=>n.classList.remove("hidden")),s.forEach(n=>n.classList.remove("hidden"))):(t.classList.remove("hidden"),a.classList.add("hidden"),r.classList.add("hidden"),d.forEach(n=>n.classList.add("hidden")),s.forEach(n=>n.classList.add("hidden")))}async function i(){const{data:e,error:t}=await l.from("articles").select("*").order("created_at",{ascending:!1});if(t){console.error("Fetch error:",t);return}h.innerHTML="",e.forEach(a=>{const r=document.createElement("article");r.className="p-4 mb-4 bg-white rounded shadow",r.innerHTML=`
      <header class="mb-2">
        <h2 class="text-xl font-semibold">${a.title}</h2>
        <h3 class="text-sm text-gray-600">${a.subtitle||""}</h3>
      </header>
      <p class="text-xs text-gray-500 mb-2">
        Autor: ${a.author} • ${new Date(a.created_at).toLocaleString()}
      </p>
      <section class="prose prose-sm">${a.content}</section>
      <footer class="mt-4 flex space-x-2">
        <button data-id="${a.id}" class="edit-btn px-3 py-1 rounded transition-transform duration-200 ease-in-out hover:scale-105">Edytuj</button>
        <button data-id="${a.id}" class="delete-btn px-3 py-1 rounded transition-transform duration-200 ease-in-out hover:scale-105">Usuń</button>
      </footer>
    `,h.appendChild(r)}),b(),await m()}function b(){document.querySelectorAll(".edit-btn").forEach(e=>{e.addEventListener("click",()=>g(e.dataset.id))}),document.querySelectorAll(".delete-btn").forEach(e=>{e.addEventListener("click",()=>E(e.dataset.id))})}v.addEventListener("click",()=>u.showModal());u.querySelector("form").addEventListener("submit",async e=>{e.preventDefault();const t=e.target,{title:a,subtitle:r,author:d,content:s}=t.elements,{error:n}=await l.from("articles").insert([{title:a.value,subtitle:r.value,author:d.value,content:s.value}],{returning:"representation"});if(n){alert("Błąd dodawania: "+n.message);return}t.reset(),u.close(),i()});let y=null;function g(e){y=e;const t=document.querySelector(`[data-id="${e}"]`).closest("article");o.querySelector("[name=title]").value=t.querySelector("h2").textContent,o.querySelector("[name=subtitle]").value=t.querySelector("h3").textContent,o.querySelector("[name=author]").value=t.querySelector("p").textContent.split("•")[0].replace("Autor: ","").trim(),o.querySelector("[name=content]").value=t.querySelector("section").innerHTML,o.showModal()}o.querySelector("form").addEventListener("submit",async e=>{e.preventDefault();const t=e.target,{title:a,subtitle:r,author:d,content:s}=t.elements,{error:n}=await l.from("articles").update({title:a.value,subtitle:r.value,author:d.value,content:s.value}).eq("id",y);if(n){alert("Błąd edycji: "+n.message);return}o.close(),i()});let f=null;function E(e){f=e,c.showModal()}c.querySelector("#cancel-delete").addEventListener("click",()=>c.close());c.querySelector("form").addEventListener("submit",async e=>{e.preventDefault();const{error:t}=await l.from("articles").delete().eq("id",f);if(t){alert("Błąd usuwania: "+t.message);return}c.close(),i()});document.getElementById("logout-btn").addEventListener("click",async()=>{await l.auth.signOut(),await m(),i()});window.addEventListener("DOMContentLoaded",async()=>{await m(),i()});
